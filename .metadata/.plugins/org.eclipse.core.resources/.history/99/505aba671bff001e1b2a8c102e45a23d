/**
 * Filename:    ApiService.java
 *
 * Description: Implementation of the ApiService class.
 *
 * Revision:    19 de abr. de 2024
 *
 * Author:      Erik Freire Vergani
 * EMail:       efvergani@hotmail.com.br
 *
 */

package com.univates.api.services;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.HttpClientErrorException;
import org.springframework.web.client.RestTemplate;

import com.univates.api.records.request.UserRecord;
import com.univates.api.security.ApiConfig;

/**
 * @author ev
 */
@Service
public class ApiService
{
    @Autowired
    private RestTemplate restTemplate;
    
    public Object callApi( UserRecord user )
    {
        try
        {
            HttpHeaders headers = new HttpHeaders();
            headers.setContentType( MediaType.APPLICATION_JSON );
            headers.set( "login", ApiConfig.API_USER );
            headers.set( "pass", ApiConfig.API_PASS );
            
            HttpEntity<UserRecord> requestEntity = new HttpEntity<>( user, headers );
            
            // Fazer a requisição POST para a API final
            ResponseEntity<String> responseEntity = restTemplate.exchange(
                    ApiConfig.API_URL,
                    HttpMethod.POST,
                    requestEntity,
                    String.class
                    );
            
            if ( responseEntity.getStatusCode().is2xxSuccessful() ) 
            {
                return requestEntity.getBody();
            } 
            
            else 
            {
                return "Erro ao acessar a API final!";
            }
        }
        
        catch ( HttpClientErrorException.Unauthorized e )
        {
            return "Unauthorized"; 
        }
    }
}
